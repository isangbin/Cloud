{% extends 'base.html' %}
{% block style %}
  body{
    margin-top:3rem;
  }
  {% comment %} * {
    margin:0; padding:0;
  } {% endcomment %}
  ul {
    list-style:none;
  }
  a {
    text-decoration:none; color:inherit;
  }
  #tab ul { 
    white-space:nowrap; 
    overflow-x: auto; text-align:center
  }
  #tab ul li {
    display:inline-block; padding: 5px 10px; margin-right:10px;
  }
  img {
    border-radius: 5%;
  }
  hr {
    border-top: 3px solid #15394a;
  }
  h1 {
    margin-left: 100px;
    margin-top: 20px;
    margin-bottom: 20px;
    color: #142a4f;
    font-weight: bold;
  }
{% endblock style %}

  
{% block content %}
<div class="row px-5 justify-content-center">
  <div class="col-11">
    <h1>MOVIE</h1>
    <hr>
    <h1>추천 영화</h1>
    <div id="tab">
      <ul id="recommended">
        
      </ul>
    </div> 
    <hr>

    <h1>좋아요 누른 영화(가제)</h1>
    <div id="tab">
      <ul>
        {% for pickedmovie in pickedmovies %}
          {% for genre in pickedmovie.genres.all %}
            {{ genre.id }}
          {% endfor %}
          <li>         
            <a href="{% url 'movies:detail' pickedmovie.movie_id %}">
              <img src="https://image.tmdb.org/t/p/w200{{ pickedmovie.poster_path }}" alt="">
            </a>
          </li>
        {% endfor %}
      </ul>
    </div> 
    <hr>

    <h1>나에게 맞을지도 모르는 영화(가제)</h1>
    <div id="tab">
      <ul>
        {% for recommend in recommends %}
          <li>         
            <a href="{% url 'movies:detail' recommend.movie_id %}">
              <img src="https://image.tmdb.org/t/p/w200{{ recommend.poster_path }}" alt="">
            </a>
          </li>
        {% endfor %}
      </ul>
    </div> 
    <hr>

    <h1>모든 영화</h1>
    <div id="tab">
      <ul>
        {% for movie in movies %}    
          <li>
            <a href="{% url 'movies:detail' movie.pk %}">
              <img src="https://image.tmdb.org/t/p/w200{{ movie.poster_path }}" alt="">
            </a>
          </li>
        {% endfor %}
      </ul>
    </div> 
    <hr>
  </div>
</div>
{% endblock content %}


{% block script %}
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>    
    const key = "e67fd4cae34071117f73a8090324311b";

    const fetchTrending = async() => {
      const url = "https://api.themoviedb.org/3/trending/all/week?api_key=" + key + "&language=ko-KR"
      const response = await axios.get(url);
      const recUlTag = document.querySelector('#recommended')
      console.log(response.data.results)

      for(let i=0; i<30; i++) {  
        newliTag = document.createElement('li')
        newaTag = document.createElement('a')
        newimgTag = document.createElement('img')

        imgLink = response.data.results[i].poster_path
        recMovieId = response.data.results[i].id
        
        newimgTag.setAttribute('src', 'https://image.tmdb.org/t/p/w200'+imgLink)
        newaTag.setAttribute('href', `/movies/${ recMovieId }`)
        
        
        newaTag.appendChild(newimgTag)
        newliTag.appendChild(newaTag)
        recUlTag.appendChild(newliTag)
      }              
    }
    fetchTrending()

  </script>
{% endblock script %}